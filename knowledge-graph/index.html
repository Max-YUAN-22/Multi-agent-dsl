<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph - Multi-Agent DSL Framework</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(255,255,255,0.2);
        }

        .lang-switch {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .main-container {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1e40af;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .knowledge-graph-container {
            width: 100%;
            height: 600px;
            background: #f8fafc;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .legend {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .legend-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e40af;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.3rem 0;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 1rem;
            z-index: 10;
        }

        .control-btn {
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn:hover {
            background: rgba(29, 78, 216, 0.9);
            transform: translateY(-2px);
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .search-container {
            margin-bottom: 2rem;
            text-align: center;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        @keyframes nodeHighlight {
            0%, 100% {
                stroke-width: 3;
                stroke: #3b82f6;
            }
            50% {
                stroke-width: 5;
                stroke: #1e40af;
            }
        }

        .highlighted {
            animation: nodeHighlight 1s ease-in-out infinite;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            pointer-events: none;
            z-index: 100;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .controls {
                position: static;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .legend {
                position: static;
                margin-bottom: 1rem;
            }

            .knowledge-graph-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-project-diagram"></i>
                <span data-lang="title">Knowledge Graph</span>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="../enterprise-platform/"><i class="fas fa-code"></i> <span data-lang="nav-dsl-demo">DSL Demo</span></a></li>
                    <li><a href="../enterprise-platform/#agents"><i class="fas fa-users"></i> <span data-lang="nav-agent-management">Agent Management</span></a></li>
                    <li><a href="../multimodal/"><i class="fas fa-comments"></i> <span data-lang="nav-multimodal-chat">Multi-modal Chat</span></a></li>
                    <li><a href="#" class="active"><i class="fas fa-project-diagram"></i> <span data-lang="nav-knowledge-graph">Knowledge Graph</span></a></li>
                    <li><a href="../enterprise-platform/#dashboard"><i class="fas fa-tachometer-alt"></i> <span data-lang="nav-dashboard">Dashboard</span></a></li>
                </ul>
            </nav>
            <div class="lang-switch" onclick="toggleLanguage()">
                <i class="fas fa-globe"></i>
                <span id="current-lang">üá∫üá∏ English</span>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="section-card">
            <h1 class="section-title">
                <i class="fas fa-project-diagram"></i>
                <span data-lang="knowledge-graph-title">Multi-Agent DSL Framework Knowledge Graph</span>
            </h1>

            <!-- ÊêúÁ¥¢Ê°Ü -->
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="ÊêúÁ¥¢ËäÇÁÇπÂíåÊèèËø∞..." data-lang-placeholder="search-placeholder">
            </div>

            <!-- ËøáÊª§Âô® -->
            <div class="filter-section">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-globe"></i>
                    <span data-lang="filter-all">All Types</span>
                </button>
                <button class="filter-btn" data-filter="framework">
                    <i class="fas fa-cog"></i>
                    <span data-lang="filter-framework">Core Framework</span>
                </button>
                <button class="filter-btn" data-filter="algorithm">
                    <i class="fas fa-brain"></i>
                    <span data-lang="filter-algorithms">Core Algorithms</span>
                </button>
                <button class="filter-btn" data-filter="agent">
                    <i class="fas fa-robot"></i>
                    <span data-lang="filter-agents">Intelligent Agents</span>
                </button>
                <button class="filter-btn" data-filter="component">
                    <i class="fas fa-cube"></i>
                    <span data-lang="filter-components">System Components</span>
                </button>
            </div>

            <!-- Áü•ËØÜÂõæË∞±ÂÆπÂô® -->
            <div class="knowledge-graph-container">
                <!-- Âõæ‰æã -->
                <div class="legend">
                    <div class="legend-title" data-lang="legend-title">Legend</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        <span data-lang="legend-framework">Core Framework</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span data-lang="legend-algorithms">Core Algorithms</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #10b981;"></div>
                        <span data-lang="legend-agents">Intelligent Agents</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span data-lang="legend-components">System Components</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8b5cf6;"></div>
                        <span data-lang="legend-analytics">Monitoring & Analytics</span>
                    </div>
                </div>

                <!-- ÊéßÂà∂ÊåâÈíÆ -->
                <div class="controls">
                    <button class="control-btn" onclick="resetGraph()">
                        <i class="fas fa-refresh"></i>
                        <span data-lang="reset-graph">Reset</span>
                    </button>
                    <button class="control-btn" onclick="toggleAnimation()">
                        <i class="fas fa-play" id="animation-icon"></i>
                        <span data-lang="toggle-animation" id="animation-text">Enable Animation</span>
                    </button>
                </div>

                <!-- ÂõæË∞±SVG -->
                <svg id="knowledge-graph-svg" width="100%" height="100%"></svg>

                <!-- Â∑•ÂÖ∑ÊèêÁ§∫ -->
                <div class="tooltip" id="tooltip"></div>
            </div>
        </div>

        <!-- ËøîÂõû‰∏ªÈ°µÈìæÊé• -->
        <div style="text-align: center; margin-top: 2rem;">
            <a href="../" style="background: rgba(255,255,255,0.2); color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-home"></i>
                <span data-lang="back-home">ËøîÂõû‰∏ªÈ°µ</span>
            </a>
        </div>
    </div>

    <script>
        // Â§öËØ≠Ë®ÄÊîØÊåÅ
        const languages = {
            'zh': {
                'title': 'Áü•ËØÜÂõæË∞±',
                'nav-dsl-demo': 'DSL ÊºîÁ§∫',
                'nav-agent-management': 'Agent ÁÆ°ÁêÜ',
                'nav-multimodal-chat': 'Â§öÊ®°ÊÄÅËÅäÂ§©',
                'nav-knowledge-graph': 'Áü•ËØÜÂõæË∞±',
                'nav-dashboard': '‰ª™Ë°®Êùø',
                'knowledge-graph-title': 'Â§öÊô∫ËÉΩ‰ΩìDSLÊ°ÜÊû∂Áü•ËØÜÂõæË∞±',
                'search-placeholder': 'ÊêúÁ¥¢ËäÇÁÇπÂíåÊèèËø∞...',
                'filter-all': 'ÊâÄÊúâÁ±ªÂûã',
                'filter-framework': 'Ê†∏ÂøÉÊ°ÜÊû∂',
                'filter-algorithms': 'Ê†∏ÂøÉÁÆóÊ≥ï',
                'filter-agents': 'Êô∫ËÉΩ‰Ωì',
                'filter-components': 'Á≥ªÁªüÁªÑ‰ª∂',
                'legend-title': 'Âõæ‰æã',
                'legend-framework': 'Ê†∏ÂøÉÊ°ÜÊû∂',
                'legend-algorithms': 'Ê†∏ÂøÉÁÆóÊ≥ï',
                'legend-agents': 'Êô∫ËÉΩ‰Ωì',
                'legend-components': 'Á≥ªÁªüÁªÑ‰ª∂',
                'legend-analytics': 'ÁõëÊéßÂàÜÊûê',
                'reset-graph': 'ÈáçÁΩÆ',
                'toggle-animation': 'ÂêØÁî®Âä®Áîª',
                'back-home': 'ËøîÂõû‰∏ªÈ°µ'
            },
            'en': {
                'title': 'Knowledge Graph',
                'nav-dsl-demo': 'DSL Demo',
                'nav-agent-management': 'Agent Management',
                'nav-multimodal-chat': 'Multi-modal Chat',
                'nav-knowledge-graph': 'Knowledge Graph',
                'nav-dashboard': 'Dashboard',
                'knowledge-graph-title': 'Multi-Agent DSL Framework Knowledge Graph',
                'search-placeholder': 'Search nodes and descriptions...',
                'filter-all': 'All Types',
                'filter-framework': 'Core Framework',
                'filter-algorithms': 'Core Algorithms',
                'filter-agents': 'Intelligent Agents',
                'filter-components': 'System Components',
                'legend-title': 'Legend',
                'legend-framework': 'Core Framework',
                'legend-algorithms': 'Core Algorithms',
                'legend-agents': 'Intelligent Agents',
                'legend-components': 'System Components',
                'legend-analytics': 'Monitoring & Analytics',
                'reset-graph': 'Reset',
                'toggle-animation': 'Enable Animation',
                'back-home': 'Back Home'
            }
        };

        let currentLang = 'zh';
        let animationEnabled = false;
        let currentFilter = 'all';
        let simulation;
        let svg, g;
        let tooltip;

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguage();
            document.getElementById('current-lang').textContent =
                currentLang === 'zh' ? 'üá∫üá∏ English' : 'üá®üá≥ ‰∏≠Êñá';
        }

        function updateLanguage() {
            const elements = document.querySelectorAll('[data-lang]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang');
                if (languages[currentLang][key]) {
                    element.textContent = languages[currentLang][key];
                }
            });

            // Êõ¥Êñ∞Âç†‰ΩçÁ¨¶ÊñáÊú¨
            const placeholderElements = document.querySelectorAll('[data-lang-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-lang-placeholder');
                if (languages[currentLang][key]) {
                    element.placeholder = languages[currentLang][key];
                }
            });
        }

        // Áü•ËØÜÂõæË∞±Êï∞ÊçÆ
        const graphData = {
            nodes: [
                // Ê†∏ÂøÉÊ°ÜÊû∂
                { id: 'MultiAgent', group: 'framework', type: 'Core Framework' },

                // Ê†∏ÂøÉÁÆóÊ≥ï
                { id: 'ATSLP', group: 'algorithm', type: 'Core Algorithm' },
                { id: 'HCMPL', group: 'algorithm', type: 'Core Algorithm' },
                { id: 'CALK', group: 'algorithm', type: 'Core Algorithm' },

                // Êô∫ËÉΩ‰Ωì
                { id: 'Weather', group: 'agent', type: 'Weather Agent' },
                { id: 'Traffic', group: 'agent', type: 'Traffic Agent' },
                { id: 'Parking', group: 'agent', type: 'Parking Agent' },
                { id: 'Safety', group: 'agent', type: 'Safety Agent' },
                { id: 'EMS', group: 'agent', type: 'Emergency Agent' },

                // Á≥ªÁªüÁªÑ‰ª∂
                { id: 'TaskBuilder', group: 'component', type: 'Task Builder' },
                { id: 'AgentManager', group: 'component', type: 'Agent Manager' },
                { id: 'LLMIntegration', group: 'component', type: 'LLM Integration' },

                // ÁõëÊéßÂàÜÊûê
                { id: 'MetricsCollector', group: 'analytics', type: 'Metrics Collector' },
                { id: 'PerformanceMonitor', group: 'analytics', type: 'Performance Monitor' },
                { id: 'KnowledgeBase', group: 'analytics', type: 'Knowledge Base' }
            ],
            links: [
                // Ê†∏ÂøÉÊ°ÜÊû∂ËøûÊé•
                { source: 'MultiAgent', target: 'ATSLP', type: 'uses' },
                { source: 'MultiAgent', target: 'HCMPL', type: 'uses' },
                { source: 'MultiAgent', target: 'CALK', type: 'uses' },

                // ÁÆóÊ≥ï‰∏éÊô∫ËÉΩ‰ΩìËøûÊé•
                { source: 'ATSLP', target: 'Weather', type: 'schedules' },
                { source: 'ATSLP', target: 'Traffic', type: 'schedules' },
                { source: 'ATSLP', target: 'Parking', type: 'schedules' },
                { source: 'HCMPL', target: 'Safety', type: 'coordinates' },
                { source: 'HCMPL', target: 'EMS', type: 'coordinates' },
                { source: 'CALK', target: 'Weather', type: 'learns_from' },
                { source: 'CALK', target: 'Traffic', type: 'learns_from' },

                // Á≥ªÁªüÁªÑ‰ª∂ËøûÊé•
                { source: 'MultiAgent', target: 'TaskBuilder', type: 'manages' },
                { source: 'MultiAgent', target: 'AgentManager', type: 'manages' },
                { source: 'MultiAgent', target: 'LLMIntegration', type: 'integrates' },

                // Êô∫ËÉΩ‰ΩìÂçè‰Ωú
                { source: 'Weather', target: 'Traffic', type: 'collaborates' },
                { source: 'Traffic', target: 'Parking', type: 'collaborates' },
                { source: 'Safety', target: 'EMS', type: 'collaborates' },

                // ÁõëÊéßÂàÜÊûêËøûÊé•
                { source: 'MultiAgent', target: 'MetricsCollector', type: 'monitors' },
                { source: 'MetricsCollector', target: 'PerformanceMonitor', type: 'feeds' },
                { source: 'CALK', target: 'KnowledgeBase', type: 'stores_in' },

                // ÁªÑ‰ª∂‰∏éÊô∫ËÉΩ‰ΩìËøûÊé•
                { source: 'TaskBuilder', target: 'Weather', type: 'builds_tasks' },
                { source: 'TaskBuilder', target: 'Traffic', type: 'builds_tasks' },
                { source: 'AgentManager', target: 'Safety', type: 'manages' },
                { source: 'AgentManager', target: 'EMS', type: 'manages' }
            ]
        };

        // È¢úËâ≤Êò†Â∞Ñ
        const colorMap = {
            'framework': '#3b82f6',
            'algorithm': '#ef4444',
            'agent': '#10b981',
            'component': '#f59e0b',
            'analytics': '#8b5cf6'
        };

        function initKnowledgeGraph() {
            const container = document.getElementById('knowledge-graph-svg');
            const rect = container.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;

            svg = d3.select('#knowledge-graph-svg')
                .attr('width', width)
                .attr('height', height);

            g = svg.append('g');
            tooltip = d3.select('#tooltip');

            // Áº©ÊîæÂíåÊãñÊãΩ
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // ÂäõÂØºÂêëÂ∏ÉÂ±Ä
            simulation = d3.forceSimulation(graphData.nodes)
                .force('link', d3.forceLink(graphData.links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));

            renderGraph();
        }

        function renderGraph() {
            // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
            g.selectAll('*').remove();

            // ËøáÊª§Êï∞ÊçÆ
            let filteredNodes = graphData.nodes;
            let filteredLinks = graphData.links;

            if (currentFilter !== 'all') {
                filteredNodes = graphData.nodes.filter(d => d.group === currentFilter);
                const nodeIds = new Set(filteredNodes.map(d => d.id));
                filteredLinks = graphData.links.filter(d => nodeIds.has(d.source.id || d.source) && nodeIds.has(d.target.id || d.target));
            }

            // ÁªòÂà∂ËøûÊé•Á∫ø
            const link = g.append('g')
                .selectAll('line')
                .data(filteredLinks)
                .enter()
                .append('line')
                .attr('stroke', '#94a3b8')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', d => d.type === 'collaborates' ? '5,5' : null);

            // ÁªòÂà∂ËäÇÁÇπ
            const node = g.append('g')
                .selectAll('circle')
                .data(filteredNodes)
                .enter()
                .append('circle')
                .attr('r', d => d.group === 'framework' ? 25 : 20)
                .attr('fill', d => colorMap[d.group])
                .attr('stroke', '#ffffff')
                .attr('stroke-width', 3)
                .style('cursor', 'pointer')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended))
                .on('mouseover', (event, d) => {
                    showTooltip(event, d);
                })
                .on('mouseout', () => {
                    hideTooltip();
                })
                .on('click', (event, d) => {
                    highlightNode(d);
                });

            // Ê∑ªÂä†Ê†áÁ≠æ
            const label = g.append('g')
                .selectAll('text')
                .data(filteredNodes)
                .enter()
                .append('text')
                .attr('text-anchor', 'middle')
                .attr('dy', '.35em')
                .attr('fill', 'white')
                .attr('font-size', '12px')
                .attr('font-weight', 'bold')
                .attr('pointer-events', 'none')
                .text(d => d.id);

            // Êõ¥Êñ∞‰ªøÁúü
            simulation.nodes(filteredNodes);
            simulation.force('link').links(filteredLinks);
            simulation.restart();

            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);

                label
                    .attr('x', d => d.x)
                    .attr('y', d => d.y);
            });
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function showTooltip(event, d) {
            tooltip
                .style('opacity', 1)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px')
                .html(`<strong>${d.id}</strong><br>${d.type}`);
        }

        function hideTooltip() {
            tooltip.style('opacity', 0);
        }

        function highlightNode(d) {
            // ÁßªÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ
            g.selectAll('circle').classed('highlighted', false);

            // È´ò‰∫ÆÈÄâ‰∏≠ËäÇÁÇπ
            g.selectAll('circle')
                .filter(node => node.id === d.id)
                .classed('highlighted', true);
        }

        function resetGraph() {
            // ÈáçÁΩÆÁº©Êîæ
            const svg = d3.select('#knowledge-graph-svg');
            svg.transition().duration(750).call(
                d3.zoom().transform,
                d3.zoomIdentity
            );

            // ÁßªÈô§È´ò‰∫Æ
            g.selectAll('circle').classed('highlighted', false);
        }

        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            const icon = document.getElementById('animation-icon');
            const text = document.getElementById('animation-text');

            if (animationEnabled) {
                icon.className = 'fas fa-pause';
                text.textContent = currentLang === 'zh' ? 'ÊöÇÂÅúÂä®Áîª' : 'Disable Animation';
                simulation.restart();
            } else {
                icon.className = 'fas fa-play';
                text.textContent = currentLang === 'zh' ? 'ÂêØÁî®Âä®Áîª' : 'Enable Animation';
                simulation.stop();
            }
        }

        // ËøáÊª§Âô®ÂäüËÉΩ
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                currentFilter = btn.getAttribute('data-filter');
                renderGraph();
            });
        });

        // ÊêúÁ¥¢ÂäüËÉΩ
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();

            if (query) {
                const matchedNodes = graphData.nodes.filter(node =>
                    node.id.toLowerCase().includes(query) ||
                    node.type.toLowerCase().includes(query)
                );

                // È´ò‰∫ÆÂåπÈÖçÁöÑËäÇÁÇπ
                g.selectAll('circle').classed('highlighted', false);
                g.selectAll('circle')
                    .filter(d => matchedNodes.some(node => node.id === d.id))
                    .classed('highlighted', true);
            } else {
                g.selectAll('circle').classed('highlighted', false);
            }
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage();
            setTimeout(initKnowledgeGraph, 100);

            // Á™óÂè£Â§ßÂ∞èÂèòÂåñÊó∂ÈáçÊñ∞ÂàùÂßãÂåñ
            window.addEventListener('resize', () => {
                setTimeout(initKnowledgeGraph, 100);
            });
        });
    </script>
</body>
</html>