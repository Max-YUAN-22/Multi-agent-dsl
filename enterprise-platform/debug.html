<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼ä¸šå¹³å°è°ƒè¯•ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .link-section {
            margin: 30px 0;
            padding: 20px;
            background: #e9ecef;
            border-radius: 5px;
        }
        .link-section a {
            display: inline-block;
            margin: 5px 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
        }
        .link-section a:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ› ï¸ ä¼ä¸šå¹³å°è°ƒè¯•å·¥å…·</h1>

        <div class="status info">
            <strong>å½“å‰çŠ¶æ€ï¼š</strong> è°ƒè¯•æ¨¡å¼è¿è¡Œä¸­ | <strong>æ—¶é—´ï¼š</strong> <span id="current-time"></span>
        </div>

        <h3>ğŸ” å¿«é€Ÿè¯Šæ–­</h3>
        <div>
            <button class="test-button" onclick="testResourceLoading()">æµ‹è¯•èµ„æºåŠ è½½</button>
            <button class="test-button" onclick="testJavaScript()">æµ‹è¯•JavaScript</button>
            <button class="test-button" onclick="testNetworkAccess()">æµ‹è¯•ç½‘ç»œè®¿é—®</button>
            <button class="test-button" onclick="testMainApp()">æµ‹è¯•ä¸»åº”ç”¨</button>
            <button class="test-button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <h3>ğŸ“Š è¯Šæ–­ç»“æœ</h3>
        <div id="diagnostic-results"></div>

        <h3>ğŸ“ å®æ—¶æ—¥å¿—</h3>
        <div class="log-container" id="log-container"></div>

        <div class="link-section">
            <h3>ğŸ”— å¿«é€Ÿè®¿é—®</h3>
            <a href="index.html">æ­£å¼ç‰ˆå¹³å°</a>
            <a href="simple.html">ç®€åŒ–ç‰ˆå¹³å°</a>
            <a href="working-test.html">åŠŸèƒ½æµ‹è¯•</a>
            <a href="index-redirect.html">é‡å®šå‘é¡µé¢</a>
        </div>

        <div class="link-section">
            <h3>ğŸ”§ è°ƒè¯•é€‰é¡¹</h3>
            <button class="test-button" onclick="enableDebugMode()">å¯ç”¨è°ƒè¯•æ¨¡å¼</button>
            <button class="test-button" onclick="simulateError()">æ¨¡æ‹Ÿé”™è¯¯</button>
            <button class="test-button" onclick="testLoadingTimeout()">æµ‹è¯•åŠ è½½è¶…æ—¶</button>
            <button class="test-button" onclick="checkConsoleErrors()">æ£€æŸ¥æ§åˆ¶å°é”™è¯¯</button>
        </div>
    </div>

    <script>
        // æ—¥å¿—ç³»ç»Ÿ
        const logContainer = document.getElementById('log-container');
        const resultsContainer = document.getElementById('diagnostic-results');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = \`[\${timestamp}] \${message}\`;
            logEntry.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#333';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;

            console.log(\`[\${timestamp}] \${message}\`);
        }

        function addResult(test, success, details = '') {
            const result = document.createElement('div');
            result.className = \`status \${success ? 'success' : 'error'}\`;
            result.innerHTML = \`<strong>\${test}:</strong> \${success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'} \${details}\`;
            resultsContainer.appendChild(result);
        }

        function clearLogs() {
            logContainer.innerHTML = '';
            resultsContainer.innerHTML = '';
            log('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        updateTime();
        setInterval(updateTime, 1000);

        // æµ‹è¯•å‡½æ•°
        function testResourceLoading() {
            log('å¼€å§‹æµ‹è¯•èµ„æºåŠ è½½...', 'info');

            // æµ‹è¯•CSSåŠ è½½
            const cssTest = document.createElement('link');
            cssTest.rel = 'stylesheet';
            cssTest.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css';
            cssTest.onload = () => {
                log('CSSèµ„æºåŠ è½½æˆåŠŸ', 'success');
                addResult('CSSèµ„æºåŠ è½½', true);
            };
            cssTest.onerror = () => {
                log('CSSèµ„æºåŠ è½½å¤±è´¥', 'error');
                addResult('CSSèµ„æºåŠ è½½', false);
            };
            document.head.appendChild(cssTest);

            // æµ‹è¯•JSåŠ è½½
            const jsTest = document.createElement('script');
            jsTest.src = 'https://cdn.jsdelivr.net/npm/chart.js';
            jsTest.onload = () => {
                log('JSåº“åŠ è½½æˆåŠŸ', 'success');
                addResult('JSåº“åŠ è½½', true);
            };
            jsTest.onerror = () => {
                log('JSåº“åŠ è½½å¤±è´¥', 'error');
                addResult('JSåº“åŠ è½½', false);
            };
            document.head.appendChild(jsTest);
        }

        function testJavaScript() {
            log('å¼€å§‹æµ‹è¯•JavaScriptåŠŸèƒ½...', 'info');

            try {
                // æµ‹è¯•ES6ç‰¹æ€§
                const arrow = () => 'test';
                const [a, b] = [1, 2];
                const template = \`Template: \${arrow()}\`;

                log('ES6ç‰¹æ€§æµ‹è¯•é€šè¿‡', 'success');
                addResult('ES6ç‰¹æ€§', true, '- ç®­å¤´å‡½æ•°ã€è§£æ„ã€æ¨¡æ¿å­—ç¬¦ä¸²æ­£å¸¸');

                // æµ‹è¯•å¼‚æ­¥åŠŸèƒ½
                Promise.resolve('async test').then(result => {
                    log('Promiseæµ‹è¯•é€šè¿‡', 'success');
                    addResult('Promiseæ”¯æŒ', true);
                });

                // æµ‹è¯•ç±»å’Œç»§æ‰¿
                class TestClass {
                    constructor(name) { this.name = name; }
                    getName() { return this.name; }
                }
                const instance = new TestClass('test');

                if (instance.getName() === 'test') {
                    log('ç±»å’Œç»§æ‰¿æµ‹è¯•é€šè¿‡', 'success');
                    addResult('ES6ç±»æ”¯æŒ', true);
                }

            } catch (error) {
                log(\`JavaScriptæµ‹è¯•å¤±è´¥: \${error.message}\`, 'error');
                addResult('JavaScriptåŠŸèƒ½', false, error.message);
            }
        }

        function testNetworkAccess() {
            log('å¼€å§‹æµ‹è¯•ç½‘ç»œè®¿é—®...', 'info');

            // æµ‹è¯•GitHub Pagesè®¿é—®
            fetch('https://api.github.com/zen')
                .then(response => {
                    if (response.ok) {
                        log('å¤–éƒ¨ç½‘ç»œè®¿é—®æ­£å¸¸', 'success');
                        addResult('ç½‘ç»œè®¿é—®', true, '- GitHub APIå“åº”æ­£å¸¸');
                        return response.text();
                    } else {
                        throw new Error(\`HTTP \${response.status}\`);
                    }
                })
                .then(data => {
                    log(\`ç½‘ç»œå“åº”: \${data.substring(0, 50)}...\`, 'info');
                })
                .catch(error => {
                    log(\`ç½‘ç»œè®¿é—®å¤±è´¥: \${error.message}\`, 'error');
                    addResult('ç½‘ç»œè®¿é—®', false, error.message);
                });
        }

        function testMainApp() {
            log('å¼€å§‹æµ‹è¯•ä¸»åº”ç”¨åŠ è½½...', 'info');

            // æ£€æŸ¥ä¸»åº”ç”¨æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            fetch('app.js')
                .then(response => {
                    if (response.ok) {
                        log('app.jsæ–‡ä»¶è®¿é—®æ­£å¸¸', 'success');
                        addResult('ä¸»åº”ç”¨æ–‡ä»¶', true, \`- æ–‡ä»¶å¤§å°: \${response.headers.get('content-length') || 'æœªçŸ¥'} bytes\`);

                        // å°è¯•åŠ è½½å¹¶æ‰§è¡Œ
                        const script = document.createElement('script');
                        script.src = 'app.js';
                        script.onload = () => {
                            log('ä¸»åº”ç”¨è„šæœ¬åŠ è½½æˆåŠŸ', 'success');
                            addResult('è„šæœ¬æ‰§è¡Œ', true);

                            // æ£€æŸ¥å¹³å°å¯¹è±¡æ˜¯å¦åˆ›å»º
                            setTimeout(() => {
                                if (window.platform) {
                                    log('å¹³å°å¯¹è±¡åˆ›å»ºæˆåŠŸ', 'success');
                                    addResult('å¹³å°å¯¹è±¡', true);
                                } else {
                                    log('å¹³å°å¯¹è±¡æœªæ‰¾åˆ°', 'error');
                                    addResult('å¹³å°å¯¹è±¡', false);
                                }
                            }, 2000);
                        };
                        script.onerror = () => {
                            log('ä¸»åº”ç”¨è„šæœ¬åŠ è½½å¤±è´¥', 'error');
                            addResult('è„šæœ¬æ‰§è¡Œ', false);
                        };
                        document.head.appendChild(script);

                    } else {
                        throw new Error(\`HTTP \${response.status}\`);
                    }
                })
                .catch(error => {
                    log(\`ä¸»åº”ç”¨æ–‡ä»¶è®¿é—®å¤±è´¥: \${error.message}\`, 'error');
                    addResult('ä¸»åº”ç”¨æ–‡ä»¶', false, error.message);
                });
        }

        function enableDebugMode() {
            log('å¯ç”¨è°ƒè¯•æ¨¡å¼...', 'info');

            // æ·»åŠ å…¨å±€é”™è¯¯ç›‘å¬
            window.addEventListener('error', (e) => {
                log(\`å…¨å±€é”™è¯¯: \${e.message} (\${e.filename}:\${e.lineno})\`, 'error');
            });

            window.addEventListener('unhandledrejection', (e) => {
                log(\`æœªå¤„ç†çš„Promiseæ‹’ç»: \${e.reason}\`, 'error');
            });

            // å¯ç”¨è¯¦ç»†æ—¥å¿—
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                log(args.join(' '), 'info');
            };

            log('è°ƒè¯•æ¨¡å¼å·²å¯ç”¨', 'success');
            addResult('è°ƒè¯•æ¨¡å¼', true, '- é”™è¯¯ç›‘å¬å·²å¯ç”¨');
        }

        function simulateError() {
            log('æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µ...', 'info');

            try {
                // æ•…æ„è§¦å‘é”™è¯¯
                nonExistentFunction();
            } catch (error) {
                log(\`æ•è·åˆ°æ¨¡æ‹Ÿé”™è¯¯: \${error.message}\`, 'error');
                addResult('é”™è¯¯å¤„ç†', true, '- é”™è¯¯æ•è·æœºåˆ¶æ­£å¸¸');
            }
        }

        function testLoadingTimeout() {
            log('æµ‹è¯•åŠ è½½è¶…æ—¶æœºåˆ¶...', 'info');

            // æ¨¡æ‹Ÿé•¿æ—¶é—´åŠ è½½
            const timeout = setTimeout(() => {
                log('åŠ è½½è¶…æ—¶æµ‹è¯• - 10ç§’åè§¦å‘', 'warning');
                addResult('è¶…æ—¶æœºåˆ¶', true, '- è¶…æ—¶æ£€æµ‹æ­£å¸¸');
            }, 10000);

            // 5ç§’åå–æ¶ˆ
            setTimeout(() => {
                clearTimeout(timeout);
                log('åŠ è½½è¶…æ—¶æµ‹è¯•å·²å–æ¶ˆ', 'info');
            }, 5000);
        }

        function checkConsoleErrors() {
            log('æ£€æŸ¥æ§åˆ¶å°é”™è¯¯...', 'info');

            // æ£€æŸ¥å¸¸è§çš„å…¨å±€å¯¹è±¡
            const checks = [
                { name: 'fetch API', check: () => typeof fetch !== 'undefined' },
                { name: 'Promise', check: () => typeof Promise !== 'undefined' },
                { name: 'localStorage', check: () => typeof localStorage !== 'undefined' },
                { name: 'console', check: () => typeof console !== 'undefined' },
                { name: 'document', check: () => typeof document !== 'undefined' },
                { name: 'window', check: () => typeof window !== 'undefined' }
            ];

            checks.forEach(({ name, check }) => {
                try {
                    const result = check();
                    log(\`\${name}: \${result ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}\`, result ? 'success' : 'error');
                    addResult(name, result);
                } catch (error) {
                    log(\`\${name} æ£€æŸ¥å¤±è´¥: \${error.message}\`, 'error');
                    addResult(name, false, error.message);
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆæ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', () => {
            log('è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('å»ºè®®å…ˆè¿è¡Œ"æµ‹è¯•JavaScript"å’Œ"æµ‹è¯•ä¸»åº”ç”¨"', 'info');
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': testJavaScript(); break;
                    case '2': testResourceLoading(); break;
                    case '3': testMainApp(); break;
                    case 'l': clearLogs(); break;
                }
            }
        });

        log('ğŸ› ï¸ è°ƒè¯•å·¥å…·å·²å°±ç»ª - ä½¿ç”¨Ctrl+1/2/3è¿›è¡Œå¿«é€Ÿæµ‹è¯•', 'info');
    </script>
</body>
</html>